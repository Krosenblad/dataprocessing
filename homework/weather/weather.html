<html>
<header>
	<h2> Average Temperature De Bilt Weather Station </h2>
	<p> Homework week 2, Kajsa Rosenblad </p>
</header>
<canvas id="graph" width="600" height="600">
	Here I will draw a graph
</canvas>

<script>

function reqListener () {

  // Loads data from textarea
  var rawdata = this.responseText

  // Splits data per line
  rawdata = rawdata.split("\n")
  
  date = []
  temp = []
  
  for (let i = 0; i < rawdata.length - 1; i++){
  	
  	item = rawdata[i].split(",")
  	dates = item[1]
  	datum = ""
  	
  	for (let n = 0; n < dates.length; n++){

  		datum += (dates[n])

  		if (n == 3 || n == 5 )
  			datum += "-"
  	}
  	date.push(new Date(datum))
  	temp.push(Number(item[2]))
  }

  	// Transform dates into millisecond it started
    for (let sec = 0; sec < date.length; sec++){
    	date[sec] = date[sec].getTime()
    	date[sec] = (date[sec] / 86400000) - 9495
    	
    }

  function createTransform(domain, range){
	// domain is a two-element array of the data bounds [domain_min, domain_max]
	// range is a two-element array of the screen bounds [range_min, range_max]
	// this gives you two equations to solve:
	// range_min = alpha * domain_min + beta
	// range_max = alpha * domain_max + beta

 		// a solution would be:

    var domain_min = domain[0]
    var domain_max = domain[1]
    var range_min = range[0]
    var range_max = range[1]

    // formulas to calculate the alpha and the beta
   	var alpha = (range_max - range_min) / (domain_max - domain_min)
    var beta = range_max - alpha * domain_max

    // returns the function for the linear transformation (y= a * x + b)
    return function(x){
      return alpha * x + beta;
    }}

    var domainDate = [Math.min.apply(null, date), Math.max.apply(null, date)]
    var domainTemp = [Math.min.apply(null, temp), Math.max.apply(null, temp)]
    console.log(Math.min.apply(null, temp), Math.max.apply(null, temp))

    var transformTemp = createTransform(domainTemp, [480, 35])
    var transformDate = createTransform(domainDate, [35, 480])
    
    // Initiate canvas
    var canvas = document.getElementById('graph'); 
	var ctx = canvas.getContext('2d');

	//Graph space
	ctx.beginPath();
	ctx.moveTo(30,10);
	ctx.lineTo(30,490);
	ctx.lineTo(480,490)
	ctx.stroke()

	// Draws temperature line
	ctx.beginPath();
	ctx.moveTo(35.00000000000001, 376.25);
	
	var tempCord = []
	var dateCord = []
	for (let i = 0; i < date.length; i++){
		
		tempCord[i] = transformTemp(temp[i])
		dateCord[i] = transformDate(date[i])
	}
	console.log(tempCord[0], dateCord[0])

	for (let i = 0; i < date.length; i++){
		ctx.lineTo(dateCord[i], tempCord[i])
	}
	
	ctx.stroke()
	
	
	// Create coordinates for lines to denotate months, start at 25 (since graph starts there)
	months = []
	month = 35
	
	for (let i = 0; i < 12; i++){
		months[i] = month
		
		// Calculate how big the steps have to be by using the length of the graph divided by 12
		month = month + ((480-35)/12)

	}
	console.log(months)
	
	for (let i = 0; i < 12; i ++){
		
		ctx.beginPath();
		ctx.moveTo(months[i], 490);
		ctx.lineTo(months[i], 500);
		ctx.stroke()

	}

	// Create coordinates for lines to denotate temperature
	tempLine = []
	line = 480

	for (let i = 0; i < 8 ; i++){
		tempLine[i] = line;
		line = line - (480/8);
	}
	
	temps = [-100, -50, 0, 50, 100, 150, 200, 250]
	
	for (let i = 0; i < 8; i++){
		ctx.beginPath();
		ctx.moveTo(30, tempLine[i]);
		ctx.lineTo(20, tempLine[i]);
		ctx.stroke()
		ctx.font = "10px Arial"
		ctx.fillText (temps[i], 0, tempLine[i])
	}
	
	// Create list of months to use in loop
	monthName =["January", "February", "Mars", "April", "May", "June", "July", "August", 
	"September", "October", "November", "December"]

	for (let i = 0; i < monthName.length; i++){
		ctx.save();
		ctx.translate(months[i], 550);
		ctx.rotate(-Math.PI/2);
		ctx.textAlign = "right";
		ctx.fillText(monthName[i], 40, 0);
		ctx.restore();
	}

	ctx.save();
	ctx.translate(0, 530);
	ctx.rotate(-Math.PI / 4);

	ctx.textAlign = 'right';
	ctx.fillText('1996', 40, 0);

	ctx.restore();

	}

// https://raw.githubusercontent.com/Krosenblad/dataprocessing/master/homework/weather/KNMI_19961231.txt
// /homework/weather/KNMI_19961231.txt
var url = "https://raw.githubusercontent.com/Krosenblad/dataprocessing/master/homework/weather/KNMI_19961231.txt";

var oReq = new XMLHttpRequest();
oReq.addEventListener('load', reqListener);
oReq.open("get", url, true);
oReq.send();

</script>





